{"version":3,"sources":["App.tsx","config.ts","index.tsx","../node_modules/peerjs/dist sync"],"names":["myPeer","connOption","host","port","path","debug","config","iceServers","url","credential","username","Header","Layout","Footer","Content","Title","Typography","Text","key","Math","floor","random","App","useState","isConnecting","setIsConnecting","inputValue","setInputValue","handleCall","useCallback","call","console","log","navigator","getUserMedia","video","audio","stream","videoLocal","document","getElementById","srcObject","play","answer","on","videoRemote","handleReceive","conn","data","type","Modal","confirm","title","content","payload","onCancel","send","setTimeout","close","onOk","message","success","error","useEffect","Peer","connect","className","style","minHeight","color","fontSize","size","VideoCameraTwoTone","display","justifyContent","alignItems","height","width","margin","direction","level","Search","onSearch","value","placeholder","id","position","right","bottom","padding","onClick","destroyed","undefined","background","borderRadius","marginRight","PhoneOutlined","FormOutlined","FileOutlined","textAlign","left","rootElement","render","webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports"],"mappings":"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","file":"static/js/main.4cc823ee.chunk.js","sourcesContent":["import \"./styles.css\";\nimport { Layout, Space, Card, Typography, Input, message, Modal } from \"antd\";\nimport {\n  VideoCameraTwoTone,\n  PhoneOutlined,\n  FileOutlined,\n  FormOutlined,\n} from \"@ant-design/icons\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { SpaceContext } from \"antd/lib/space\";\nimport { connOption } from \"./config\";\nimport Peer from \"peerjs\";\nconst { Header, Content, Footer } = Layout;\n\nconst { Title, Text } = Typography;\n\nconst key = \"key\" + Math.floor(Math.random() * 1000000);\nlet myPeer: any;\nexport default function App() {\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [inputValue, setInputValue] = useState<string>();\n\n  const handleCall = useCallback(\n    (call?: any) => {\n      console.log(\"handleCall\", call);\n      !isConnecting && setIsConnecting(true);\n      const mediaObj = {\n        video: true,\n        audio: true,\n      };\n      navigator.getUserMedia(\n        mediaObj,\n        function (stream) {\n          const videoLocal: any = document.getElementById(\"video1\");\n          if (videoLocal) {\n            videoLocal.srcObject = stream;\n            videoLocal.play();\n          }\n          if (!call) call = myPeer.call(inputValue, stream);\n          else call.answer(stream);\n          call.on(\"stream\", (stream: any) => {\n            const videoRemote: any = document.getElementById(\"video2\");\n            if (videoRemote) {\n              videoRemote.srcObject = stream;\n              videoRemote.play();\n            }\n          });\n        },\n        () => console.log(\"error\")\n      );\n      return call;\n    },\n    [inputValue, isConnecting]\n  );\n\n  // @ts-ignore\n  const handleReceive = (conn) => (data) => {\n    try {\n      console.log(\"receive data: \", data, \"type:\" + data.type);\n      if (data.type === \"conn_build\") {\n        Modal.confirm({\n          title: \"收到通话请求\",\n          content: \"来自\" + data.payload.key + \"的通话请求\",\n          onCancel: () => {\n            conn.send({ type: \"refuse\" });\n            setTimeout(() => conn.close(), 1000);\n          },\n          onOk: () => {\n            conn.send({ type: \"comfirm\" });\n          },\n        });\n      } else if (data.type === \"comfirm\") {\n        console.log(\"comfirm\");\n        message.success(\"对方已接受邀请\");\n        handleCall();\n      } else if (data.type === \"refuse\") {\n        message.error(\"对方已拒绝邀请\");\n        setTimeout(() => conn.close(), 1000);\n      }\n    } catch {\n      console.log(\"所接受数据格式错误\");\n    }\n  };\n\n  useEffect(() => {\n    if (!myPeer) {\n      myPeer = new Peer(key, connOption as any);\n      console.log(\"test\", myPeer);\n      myPeer.on(\"error\", () => {\n        message.error(\"初始化连接失败\");\n      });\n      myPeer.on(\"open\", () => {\n        message.success(\"自动注册成功\");\n      });\n      myPeer.on(\"call\", (call: any) => {\n        handleCall(call);\n      });\n      // @ts-ignore\n      myPeer.on(\"connection\", (conn) => {\n        // @ts-ignore\n        conn.on(\"data\", handleReceive(conn));\n      });\n      myPeer.on(\"close\", () => {\n        isConnecting && setIsConnecting(false);\n        message.error(\"通话已挂断\");\n      });\n    }\n  }, [isConnecting]);\n  useEffect(() => {\n    let conn: any;\n    if (inputValue) {\n      conn = myPeer.connect(inputValue);\n      conn.on(\"error\", () => {\n        message.error(\"连接失败\");\n      });\n      conn.on(\"open\", () => {\n        console.log(\"已发送连接请求\");\n        conn.send({\n          type: \"conn_build\",\n          payload: {\n            key: key,\n          },\n        });\n      });\n      // @ts-ignore\n      conn.on(\"data\", handleReceive(conn));\n    }\n    return () => {\n      if (conn) conn.close();\n    };\n  }, [inputValue]);\n  return (\n    <Layout className=\"layout\" style={{ minHeight: \"100vh\" }}>\n      <Header>\n        <div style={{ color: \"white\", fontSize: \"20px\" }}>\n          <Space size=\"middle\">\n            <VideoCameraTwoTone />\n            在线授课系统\n          </Space>\n        </div>\n      </Header>\n      <div\n        className=\"panel\"\n        style={{\n          display: !isConnecting ? \"flex\" : \"none\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          height: \"80vh\",\n        }}\n      >\n        <Card style={{ width: \"500px\", height: \"300px\", margin: \"32px\" }}>\n          <Space direction=\"vertical\">\n            <Title level={4}>基本信息</Title>\n            <div style={{ fontSize: \"16px\" }}>\n              个人ID：<Text type=\"secondary\">{key}</Text>\n            </div>\n            <div style={{ fontSize: \"16px\" }}>\n              在线时长：<Text type=\"secondary\">{\"<10分钟\"}</Text>\n            </div>\n          </Space>\n        </Card>\n        <Card style={{ width: \"500px\", height: \"300px\" }}>\n          <Space direction=\"vertical\" style={{ width: \"100%\" }}>\n            <Title level={4}>发起聊天</Title>\n            <div>\n              <Input.Search\n                onSearch={(value) => setInputValue(value)}\n                placeholder=\"请输入对方的ID\"\n              />\n            </div>\n          </Space>\n        </Card>\n      </div>\n      <div className=\"videos\" style={{ display: isConnecting ? \"\" : \"none\" }}>\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            height: \"80vh\",\n          }}\n        >\n          <div style={{ margin: \"32px\" }}>\n            <video style={{ width: \"100%\", height: \"100%\" }} id=\"video1\" />\n          </div>\n          <div style={{ margin: \"32px\" }}>\n            <video style={{ width: \"100%\", height: \"100%\" }} id=\"video2\" />\n          </div>\n        </div>\n        <div\n          style={{\n            position: \"fixed\",\n            right: \"0\",\n            bottom: \"100px\",\n            padding: \"16px\",\n          }}\n        >\n          <Space style={{ width: \"100%\" }} direction=\"vertical\" size=\"large\">\n            <div\n              onClick={() => {\n                myPeer.destroyed();\n                myPeer = undefined;\n                setIsConnecting(false);\n              }}\n              style={{\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                  alignItems: \"center\",\n                  fontSize: \"24px\",\n                  color: \"white\",\n                  width: \"48px\",\n                  height: \"48px\",\n                  background: \"#1890ff\",\n                  borderRadius: \"100%\",\n                  marginRight: \"16px\",\n                }}\n              >\n                <PhoneOutlined />\n              </div>\n              挂断通话\n            </div>\n\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                  alignItems: \"center\",\n                  fontSize: \"24px\",\n                  color: \"white\",\n                  width: \"48px\",\n                  height: \"48px\",\n                  background: \"#1890ff\",\n                  borderRadius: \"100%\",\n                  marginRight: \"16px\",\n                }}\n              >\n                <FormOutlined />\n              </div>\n              开启白板\n            </div>\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                  alignItems: \"center\",\n                  fontSize: \"24px\",\n                  color: \"white\",\n                  width: \"48px\",\n                  height: \"48px\",\n                  background: \"#1890ff\",\n                  borderRadius: \"100%\",\n                  marginRight: \"16px\",\n                }}\n              >\n                <FileOutlined />\n              </div>\n              发送文件\n            </div>\n          </Space>\n        </div>\n      </div>\n      <Footer\n        style={{\n          width: \"100%\",\n          textAlign: \"center\",\n          position: \"fixed\",\n          left: \"0\",\n          bottom: \"0\",\n          background: \"white\",\n        }}\n      >\n        {\" \"}\n        ©2021 Designed by Rui\n      </Footer>\n    </Layout>\n  );\n}\n","export const connOption = {\n  host: \"192.168.43.174\",\n  port: 9000,\n  path: \"/\",\n  debug: 3,\n  config: {\n    iceServers: [\n      { url: \"stun:stun01.sipphone.com\" },\n      { url: \"stun:stun.ekiga.net\" },\n      { url: \"stun:stun.fwdnet.net\" },\n      { url: \"stun:stun.ideasip.com\" },\n      { url: \"stun:stun.iptel.org\" },\n      { url: \"stun:stun.rixtelecom.se\" },\n      { url: \"stun:stun.schlund.de\" },\n      { url: \"stun:stun.l.google.com:19302\" },\n      { url: \"stun:stun1.l.google.com:19302\" },\n      { url: \"stun:stun2.l.google.com:19302\" },\n      { url: \"stun:stun3.l.google.com:19302\" },\n      { url: \"stun:stun4.l.google.com:19302\" },\n      { url: \"stun:stunserver.org\" },\n      { url: \"stun:stun.softjoys.com\" },\n      { url: \"stun:stun.voiparound.com\" },\n      { url: \"stun:stun.voipbuster.com\" },\n      { url: \"stun:stun.voipstunt.com\" },\n      { url: \"stun:stun.voxgratia.org\" },\n      { url: \"stun:stun.xten.com\" },\n      {\n        url: \"turn:numb.viagenie.ca\",\n        credential: \"muazkh\",\n        username: \"webrtc@live.com\",\n      },\n      {\n        url: \"turn:192.158.29.39:3478?transport=udp\",\n        credential: \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n        username: \"28224511:1379330808\",\n      },\n      {\n        url: \"turn:192.158.29.39:3478?transport=tcp\",\n        credential: \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\n        username: \"28224511:1379330808\",\n      },\n    ],\n  },\n};\n","import { render } from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 99;"],"sourceRoot":""}